<UserControl x:Class="QPlayer.Views.Knob"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:QPlayer.Views"
             x:Name="KnobInst"
             mc:Ignorable="d" 
             d:DesignHeight="250" d:DesignWidth="200">
    <Grid Margin="2" SizeChanged="Grid_SizeChanged" Loaded="Grid_Loaded">
        <StackPanel DataContext="{Binding RelativeSource={RelativeSource AncestorType=local:Knob}}">
            <Grid Height="{Binding ActualWidth, RelativeSource={RelativeSource Self}}">
                <Ellipse x:Name="KnobEllipse" 
                         MouseDown="KnobEllipse_MouseDown" MouseUp="KnobEllipse_MouseUp" MouseMove="KnobEllipse_MouseMove" MouseLeave="KnobEllipse_MouseLeave"
                         StrokeThickness="1">
                    <Ellipse.Style>
                        <Style TargetType="{x:Type Ellipse}">
                            <Setter Property="Fill" Value="{DynamicResource AREghZyBrush.Primary.2.Background.Static}"/>
                            <Setter Property="Stroke" Value="{DynamicResource AREghZyBrush.Primary.2.Border.Static}"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Trigger.Setters>
                                        <Setter Property="Fill" Value="{DynamicResource AREghZyBrush.Primary.2.Background.MouseOver}"/>
                                        <Setter Property="Stroke" Value="{DynamicResource AREghZyBrush.Primary.2.Border.MouseOver}"/>
                                    </Trigger.Setters>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Ellipse.Style>
                </Ellipse>
                <Rectangle x:Name="KnobMarker" Width="4" Fill="{Binding Stroke, ElementName=KnobEllipse}" IsHitTestVisible="False">
                    <Rectangle.RenderTransform>
                        <TransformGroup>
                            <ScaleTransform ScaleY="0.5"/>
                            <RotateTransform Angle="0" x:Name="KnobMarkerRot"/>
                        </TransformGroup>
                    </Rectangle.RenderTransform>
                </Rectangle>
                <TextBlock x:Name="ValueLabel" Text="{Binding ValueText}" Opacity="0.85" Visibility="Hidden" HorizontalAlignment="Center" VerticalAlignment="Center" TextAlignment="Center" FontSize="10" IsHitTestVisible="False"/>
                <local:TextField x:Name="ValueTextField" Text="{Binding Value}" ReturnValidates="True" Visibility="Collapsed" HorizontalAlignment="Center" VerticalAlignment="Center" LostKeyboardFocus="ValueTextField_LostKeyboardFocus"/>
            </Grid>
            <TextBlock Margin="2" Text="{Binding Label}" TextAlignment="Center"/>
        </StackPanel>
    </Grid>
</UserControl>
